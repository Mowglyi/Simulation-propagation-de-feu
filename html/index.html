<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation de propagation de feu</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1 class="title">Simulation de propagation de feu</h1>
    <div class="simulation-step" id="simulationStep">√âtape : 0</div>
    <div class="grid" id="forestGrid">
        <!-- La grille sera ajout√© ici avec javascript -->

    </div>
    <button id="simuler">Simuler</button>
    <script>

        const grid = document.getElementById('forestGrid'); //S√©lectionne l'√©l√©ment contenant  la grille de la for√™t
        const simulationStep = document.getElementById('simulationStep'); //S√©lectionne l'√©l√©ment affichant l'√©tape de la simulation
        const simulationBouton = document.getElementById('simuler'); //S√©lectionne le bouton lan√ßant la simulation
        
        // Fonction pour mettre √† jour la grille
        function updateGrid(data, step) {
            grid.innerHTML = ''; //Vide la le contenu de la grille 
            // Mettre √† jour le style de la grille avec les dimensions de la for√™t
            grid.style.gridTemplateColumns = `repeat(${data.largeur}, 50px)`;
            grid.style.width = `${data.largeur * 50}px`;

            // V√©rifier que data.foret est bien un tableau
            if (Array.isArray(data.foret)) {
                data.foret.forEach(row => {
                    // V√©rifier que chaque ligne est bien un tableau
                    if (Array.isArray(row)) {
                        row.forEach(cell => {
                            const cellElement = document.createElement('div');
                            cellElement.className = 'cell';
                            if (cell === 0) {
                                cellElement.textContent = 'üå≥';
                                cellElement.classList.add('tree');
                            } else if (cell === 1) {
                                cellElement.textContent = 'üî•';
                                cellElement.classList.add('fire');
                            } else if (cell === 2) {
                                cellElement.textContent = 'üå´Ô∏è';
                                cellElement.classList.add('burnt');
                            }
                            grid.appendChild(cellElement);
                        });
                    } else {
                        console.error('Erreur: une ligne de la for√™t n\'est pas un tableau', row);
                    }
                });
            } else {
                console.error('Erreur: data.foret n\'est pas un tableau', data.foret);
            }
            simulationStep.textContent = `√âtape : ${step}`;
        }
        function recuperationInitiale(){
            fetch("../php/api.php") //Effectue une requ√™te GET √† l'API 

            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })

            .then(text => {
                console.log('Raw response:', text);
                try {
                    const data = JSON.parse(text); //Parse la reponse au format JSON
                    if (data.error) {
                        console.error('Erreur:', data.error);
                        return;
                    }
                    updateGrid(data, 0);
                } catch (error) {
                    console.error('Erreur de parsing JSON:', error);
                    console.error('Response text:', text);
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
            });
        }
        function recuperation(step){
            fetch("../php/api.php", {
                method : "POST", 
                headers:{"Content-Type" : "application.json",}, 
                body : JSON.stringify({step: -1})
            }) //Envoie une requ√™te POST √† l'API 

            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(text => {
                console.log('Raw response:', text);
                try {
                    const data = JSON.parse(text);
                    if (data.error) {
                        console.error('Erreur:', data.error);
                        return;
                    }
                    updateGrid(data, data.step);
                } catch (error) {
                    console.error('Erreur de parsing JSON:', error);
                    console.error('Response text:', text);
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
            });
        }

        // Met √† jour la grille avec les donn√©es initiales
        recuperationInitiale();

        // Ajouter un listener pour le bouton "Simuler"
        simulationBouton.addEventListener('click', recuperation);
    </script>
</body>
</html>
